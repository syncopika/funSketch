<!doctype html>

<html>

<head>
	<title> select tool experiment </title>
	<style>
		body {
			text-align: center;
		}
		#canvasArea{
			position: relative;
			margin: 0px auto;
			width: 800px;
			height: 500px;
			border: 1px solid #000;
			overflow: hidden;
		}
		#editCanvas{
			cursor: crosshair;
		}
	</style>
</head>

<body>
	<h2> paste tool experiment </h2>
	<p> copy an image from somewhere and try pasting it on the canvas. </p>
	
	<br />

	<div id='canvasArea'>
	</div>
<body>


<script>
// https://stackoverflow.com/questions/18377891/how-can-i-let-user-paste-image-data-from-the-clipboard-into-a-canvas-element-in

function setUpMainCanvas(){
	const canvasElement = document.createElement("canvas");
	document.getElementById("canvasArea").appendChild(canvasElement);
	canvasElement.id = "main";
    canvasElement.style.zIndex = 1;
    canvasElement.style.opacity = 1;
	canvasElement.style.width = "100%";
	canvasElement.style.height = "100%";
	canvasElement.width = canvasElement.offsetWidth;
	canvasElement.height = canvasElement.offsetHeight;
    canvasElement.getContext("2d").fillStyle = "rgba(255, 255, 255, 1)";
    canvasElement.getContext("2d").fillRect(0, 0, canvasElement.width, canvasElement.height);
}
setUpMainCanvas();

function addPasteCanvas(imgData, width, height){
	const canvasElement = document.createElement("canvas");
	document.getElementById("canvasArea").appendChild(canvasElement);
	canvasElement.id = "editCanvas";
	canvasElement.style.position = "absolute";
    canvasElement.style.border = '1px #000 solid';
    canvasElement.style.zIndex = 10;
	//canvasElement.style.width = "100%";
	//canvasElement.style.height = "100%";
	canvasElement.style.top = 0;
	canvasElement.style.left = 0;
	
	canvasElement.width = width; //canvasElement.offsetWidth;
	canvasElement.height = height; //canvasElement.offsetHeight;
    const ctx = canvasElement.getContext('2d');
	ctx.drawImage(imgData, 0, 0);
	
	//ctx.fillStyle = "rgba(255,255,255,0.1)";
    //ctx.fillRect(0, 0, canvasElement.width, canvasElement.height);
	
	//return canvasElement;
}

// need to add the event listener on the document
document.addEventListener("paste", (evt) => {
	const items = (evt.clipboardData || evt.originalEvent.clipboardData).items; // items is an object of type DataTransferItemList
	
	for(let i = 0; i < items.length; i++){
		if(items[i].type.indexOf("image") > -1){
			const file = items[i]; // items[i] is a DataTransferItem type object
			const blob = file.getAsFile();
			const url = URL.createObjectURL(blob);
			
			// place the image on a new canvas (so we can allow moving it around for placement)
			const img = new Image();
			img.onload = () => {
				addPasteCanvas(img, img.width, img.height);
			};
			img.src = url;
			
			break;
		}
	}
});

// TODO
// add event listeners to the paste canvas so we can move it around (and maybe resize!?)

</script>



</html>