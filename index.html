<!doctype html>

<html>

<head>
	<title> funSketch! </title>
	<link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script type="text/javascript" src="scripts/SuperCanvas.js"></script>
	<script type="text/javascript" src="scripts/Brush.js"></script>
	<script type="text/javascript" src="scripts/Toolbar.js"></script>
	<script type="text/javascript" src="scripts/Filters.js"></script>
	<!-- web worker file needs to be in same directory as html file it's working on!
		 https://stackoverflow.com/questions/30336685/404-error-when-trying-to-register-serviceworker
	-->
	<script type="text/javascript" src="gif.worker.js"></script>
	<script type="text/javascript" src="scripts/gif.js"></script>
</head>

<style>
	html{
		/* to prevent FOUC! */
		display: none;
	}
	body, button{
		font-family: 'Merriweather', serif;
	}
	#buttons{
		text-align: center;
		border: 1px solid #000;
	}
	button{
		margin: 3px;
		font-size: 13px;
	}
	#toolbarArea{
		width: 400px;
		text-align: center;
		margin-left: 50px;
	}
	canvas{
		margin-left: 5%;
	}
	#pageCount{
		text-align: center;
	}
	#pageCount h3{
		display: inline-block;
	}
	#count{
		padding-left: 50px;
		padding-right: 50px;
	}
	#footer{
		margin-left: 20px;
	}
	#filters, #brushes{
		width: 150px;
		text-align: center;
		border: 1px solid #000;
		display: inline-block;
	}
	#colorPicker{
		margin-top: 10%;
		margin-bottom: 15%;
	}
	li{
		list-style-type: none;
		padding: 2px;
	}
	ul:not(#timeOptions){
		display: none;
		padding: 0;
	}
	a{
		text-decoration: none;
	}
	li:hover{
		color: #99b5d1;
	}
	#timeOptions{
		padding: 0;
	}
	#timeOptions li{
		display: inline-block;
	}
	#animationControl{
		text-align: center;
	}
	#filterSelect, #brushSelect{
		margin-bottom: 0;
	}
	#frameBar{
		margin-top: 5%;
		height: 500px;
		border: 1px solid #000;
	}
	
	/* accomodate smaller screens */
	@media (max-width: 1200px){
	
		#toolbarArea{
			width: 80%;
			margin: 0 auto;
		}
		#colorPicker p{
			margin-bottom: 0;
		}
		
		/* 
			there's currently a bug such that 
			when painting on a canvas on a smaller screen, 
			floodfill doesn't work.
			
			it seems like it's coloring the spot before getting 
			the color of the spot. so for now, turn it off
			for smaller screens.
		*/
		#floodfillDir, #colorPicker button{
			display: none;
		}
		
		#colorPicker, #animationControl{
			width: 45%;
			display: inline-block;
			margin: 0;
			vertical-align: top;
		}
		
		#screen{
			width: 100%;
			height: 800px;
			margin: 0 auto;
		}
		
		#footer{
			margin-top: 10%;
		}
	
	}
</style>

<body>

<div class='container-fluid'>

	<div class='row'>

		<div id='toolbar' class='col-lg-3'>
			<div id='toolbarArea'>

				<h3 id='title'> funSketch: draw, edit, and animate! </h3>

				<p> use the spacebar to create a new frame. use the left and right arrow keys to move to the previous or next frame! </p>

				<div id='buttons'>
					<button id='insertCanvas'>add layer</button>
					<button id='deleteCanvas'>delete layer</button>
					<button id='copyCanvas' onclick='newCanvas.copyCanvas()'>copy layer</button>
					<button id='clearCanvas'>clear layer</button>
					<button id='addNewFrame'>add new frame</button>
					<button id='importImage'> import image </button>
					<button id='rotateCanvasImage'>rotate image</button>
					<button id='undo'>undo</button>
					<button id='download'>download canvas (.png)</button>
					<button id='saveWork'>save project (.json)</button> 
					<button id='importProject'>import project (.json)</button> 
					<button id='toggleLayerOrFrame'> toggle frame addition on spacebar press </button>
				</div>
				
				<br>
				
				<div id='filters'>
					<p id='filterSelect'> filters &#9660; </p>
					<ul id='filterChoices'>
						<li onclick='newFilters.filterCanvas(newFilters.grayscale)'> grayscale </li>
						<li onclick='newFilters.filterCanvas(newFilters.saturate)'> saturate </li>
						<li onclick='newFilters.filterCanvas(newFilters.swap)'> colorswap </li>
						<li onclick='newFilters.filterCanvas(newFilters.scary)'> scary </li>
						<li onclick='newFilters.filterCanvas(newFilters.heatwave)'> heatwave </li>
						<li onclick='newFilters.filterCanvas(newFilters.randomize)'> noise </li>
						<li onclick='newFilters.filterCanvas(newFilters.invert)'> invert </li>
						<li onclick='newFilters.filterCanvas(newFilters.blurry)'> blur </li>
						<li onclick='newFilters.outline()'> outline </li>
						<li onclick='newFilters.defaultFisheye()'> fisheye </li>
						<li onclick='newFilters.filterCanvas(newFilters.areaColor)'> painted </li>
						<li onclick='newFilters.filterCanvas(newFilters.mosaic)'> mosaic </li>
					    <li onclick='newFilters.filterCanvas(newFilters.voronoi)'> voronoi </li>
						<li style="color: #ff3232" onclick='newToolbar.resetImage()'> reset </li>
					</ul>
				</div>

				<div id='brushes'>
					<p id='brushSelect'> brushes &#9660; </p>
					<ul>
						<li onclick='newBrush.defaultBrush()'> default brush </li>
						<li onclick='newBrush.radialGradBrush()'> radial gradient brush </li>
					</ul>
				</div>
				
				<div id='adjustBrushSize'>
					<br>
					<p class="text-info">change brush size</p>
					<input id='brushSize' type='range' min='1' max='15' step='.5' value='2' oninput='newBrush.changeBrushSize(this.value); showSize()'>
					<span id='brushSizeValue'> 2 </span>
				</div>
				
				<div id='colorPicker'>
					<div id='floodfillDir'>
						<p style='font-size: 10px'> click the button and then select a place on the canvas to floodfill </p>
						<p style='font-size: 10px'> make sure brush size is less than or equal to 2 and set to default brush! </p>
					</div>
					<button id='floodfill'>floodfill with currently selected color</button>
				</div>
				
				<!-- this should only be visible when animation mode is on -->
				<div id='animationControl'>
					<h3> animation control </h3>
					<ul id='timeOptions'>
						<li onclick='newToolbar.playBackward()'> &larr; </li>
						<li onclick='newToolbar.stop()'> stop! </li>
						<li onclick='newToolbar.playForward()'> &rarr; </li>
					</ul>
					<label>time per frame:</label>
					<select id='timePerFrame' onchange='newToolbar.timePerFrame = parseInt(value)'>
						<option value='200'>200</option>
						<option value='500'>500</option>
						<option value='700'>700</option>
						<option value='1000'>1000</option>
					</select>
					<button onclick='newToolbar.getGif("loadingScreen")'> generate gif! </button>
				</div>
				<p id='loadingScreen'></p>
				
				<br>
				
				<!-- gotta fix these? -->
				<div id='showDemos'>
					<h3> demos </h3>
					<select id='chooseDemo' onchange='getDemo(this)'>
						<option label=""></option>
						<option>run_demo</option>
						<option>floaty_thingy</option>
					</select>
				</div>
				
			</div>
		</div>

		<div id='screen' class='col-lg-6'>
			<div id='canvasArea'>
				<div id='pageCount'>
					<h3 id='prevFrame'> ◀ &nbsp;&nbsp;</h3>
					<h3 id='goLeft'> << </h3>
					<h3 id='count'> frame: 1, layer: 1 </h3>
					<h3 id='goRight'> >> </h3>
					<h3 id='nextFrame'>&nbsp;&nbsp;	▶</h3>
				</div>
			</div>
		</div>
		
	<!--
		<div id='frameBar' class='col-lg-1'>
		</div>
	-->
		
	</div> <!-- end row -->
	
	<div id='footer' class='row'>
		<hr>
		<p> n.c.h works 2017 | <a href='https://github.com/syncopika/funSketch'>source </a></p>
	</div>
	
</div> <!-- end container -->
	
</body>


<script>

// prevent FOUC
$(document).ready(function(){
	$('html').css('display', 'block');
});

// set up project
var project = new Animation('canvasArea');
var newCanvas = new SuperCanvas('canvasArea', project.frameList.length);
newCanvas.setupNewLayer();
project.add(newCanvas);

// set up brush
var newBrush = new Brush(project);
newBrush.defaultBrush();

// set up toolbar 
// here I'm passing in element Id's that these functions will attach to
var newToolbar = new Toolbar(newCanvas, newBrush, project);
newToolbar.setCounter("count");
newToolbar.setKeyDown(document);	// enables new canvas add on spacebar, go to next with right arrow, prev with left arrow.
newToolbar.createColorWheel('colorPicker', 200);
newToolbar.floodFill('floodfill');
newToolbar.insertLayer('insertCanvas');
newToolbar.deleteLayer('deleteCanvas', 'count');
newToolbar.setClearCanvas('clearCanvas');
newToolbar.rotateImage('rotateCanvasImage'); 
newToolbar.undo('undo');
newToolbar.download('download');
newToolbar.importImage('importImage');
newToolbar.save('saveWork');
newToolbar.importProject('importProject', 'count');
newToolbar.addNewFrameButton('addNewFrame');

// make the goLeft and goRight arrows clickable FOR LAYERS
// note: this is for clicking the icons with a mouse!
$('#goLeft').click(function(){
	if(newToolbar.down()){
		var curr = project.getCurrFrame();
		document.getElementById("count").textContent = "frame: " + (project.currentFrame+1) + ", layer: " + (curr.currentIndex + 1);
	}
});
$('#goRight').click(function(){
	if(newToolbar.up()){
		var curr = project.getCurrFrame();
		document.getElementById("count").textContent = "frame: " + (project.currentFrame+1) + ", layer: " + (curr.currentIndex + 1);
	}
});

// left and right arrows for FRAMES
$('#prevFrame').click(function(){
	if(newToolbar.prevFrame()){
		var curr = project.getCurrFrame();
		document.getElementById("count").textContent = "frame: " + (project.currentFrame+1) + ", layer: " + (curr.currentIndex + 1);
	}
});

$('#nextFrame').click(function(){
	if(newToolbar.nextFrame()){
		var curr = project.getCurrFrame();
		document.getElementById("count").textContent = "frame: " + (project.currentFrame+1) + ", layer: " + (curr.currentIndex + 1);
	}
});

$('#toggleLayerOrFrame').click(function(){
	element = document.getElementById("toggleLayerOrFrame");
	if(newToolbar.layerMode){
		newToolbar.layerMode = false;
		element.textContent = "toggle layer addition on spacebar press";
	}else{
		newToolbar.layerMode = true;
		element.textContent = "toggle frame addition on spacebar press";
	}
});

// set up filters object
var newFilters = new Filters(newCanvas, newBrush);

document.getElementById('filterSelect').addEventListener('click', function(){ showOptions('filters') });
document.getElementById('brushSelect').addEventListener('click', function(){ showOptions('brushes') });

// show options when clicking on filters or brushes 
function showOptions(category){
	var el = document.getElementById(category);
	var child = el.children[1]; // skip the p element and get the ul element
	if(child.style.display !== "block" ){
		child.style.display = "block";
	}else{
		child.style.display = "none";
		el.style.marginBottom  = 0;
	}
}

// update brush size display
function showSize(){
	document.getElementById('brushSizeValue').textContent = document.getElementById('brushSize').value;
}

// show some samples/demos!!
function getDemo(selectedDemo){

	// case for the blank option 
	if(selectedDemo.options[selectedDemo.selectedIndex].text === ""){
		return;
	}

	// get the selected demo from the dropbox
	// selectedDemo is the path to the demo to load 
	var selectedDemo = "demos/" + selectedDemo.options[selectedDemo.selectedIndex].text + ".json"; 

	var httpRequest = new XMLHttpRequest();

	if(!httpRequest){
		return;
	}
	
	// set request type
	httpRequest.open("GET", selectedDemo);
	
	// what to do when data comes back
	httpRequest.onload = function(){

		// reset the canvas 
		newCanvas.resetCanvas();
		
		// parse the JSON using JSON.parse 
		var data = JSON.parse(httpRequest.responseText);

		// data is an array of objects, with each object representing a canvas 
		// add the canvasses in order 
		for(var i = 0; i < data.length; i++){
			
			// create a new canvas first 
			// this adds a new blank canvas to canvas.canvasList 
			if(i > 0){
				newCanvas.setupNewLayer();
			}

			// make any changes to the dimensions based on data[i]
			var newestCanvasIndex = newCanvas.canvasList.length - 1;
			newCanvas.canvasList[newestCanvasIndex].height = data[i].height;
			newCanvas.canvasList[newestCanvasIndex].width = data[i].width;
			
			// then add the image
			var newestCanvas = newCanvas.canvasList[newestCanvasIndex];
			var newCtx = newestCanvas.getContext('2d');
			
				var img = new Image();
				
				(function(context, image){
					image.onload = function(){
							context.drawImage(image, 0, 0);
						}
					image.src = data[i].data;
				})(newCtx, img);
		}
	}
	
	// send the request 
	httpRequest.send();
}

</script>


</html>